# Backend Deployment Guide

**NOTE:** This documentation has been updated to use the custom domain `back.maxence.design` instead of the old Render default domain `https://takinggg-portfolio-backend.onrender.com`. The old domain may still work as a fallback during DNS propagation if still active.

## Overview
This guide helps you deploy the portfolio backend server to Render.com with the new service name `takinggg-portfolio-backend`.

## Current Status
- ‚ùå Old backend: `https://portfolio-backend-latest.onrender.com/api` (not accessible)
- ‚úÖ New backend: `https://back.maxence.design/api` (custom domain)
- üîÑ Fallback: `https://takinggg-portfolio-backend.onrender.com/api` (Render default)

## Deployment Steps

### 1. Deploy to Render.com

1. **Connect Repository to Render:**
   - Go to [render.com](https://render.com)
   - Sign in and click "New +"
   - Select "Web Service"
   - Connect your GitHub repository: `Takinggg/Portfolio`

2. **Configure Service:**
   - **Name:** `takinggg-portfolio-backend`
   - **Environment:** `Node`
   - **Build Command:** `npm install`
   - **Start Command:** `npm run server`
   - **Plan:** Free

3. **Environment Variables:**
   Set these environment variables in Render dashboard:
   ```
   NODE_ENV=production
   PORT=10000
   JWT_SECRET=[Auto-generated by Render]
   FRONTEND_URL=https://maxence.design
   ALLOWED_ORIGINS=https://maxence.design,https://www.maxence.design
   DATABASE_PATH=./portfolio.db
   ```

4. **Deploy:**
   - Click "Create Web Service"
   - Wait for deployment to complete
   - Verify health check at: `https://back.maxence.design/api/health`

## Custom Domain Configuration

To set up the custom domain `back.maxence.design`:

1. **DNS Configuration:**
   - Create a CNAME record: `back.maxence.design` ‚Üí `takinggg-portfolio-backend.onrender.com`
   - Wait for DNS propagation (can take up to 24 hours)

2. **Render Dashboard:**
   - Go to your service settings in Render dashboard
   - Navigate to "Custom Domains" section
   - Add custom domain: `back.maxence.design`
   - Wait for SSL certificate provisioning (automatic)

3. **Frontend Configuration:**
   - Update `VITE_API_BASE_URL` to `https://back.maxence.design/api`
   - Redeploy frontend if needed

4. **Verification:**
   - Test: `curl https://back.maxence.design/api/health`
   - Ensure SSL certificate is valid

### 2. Verify Deployment

Once deployed, test these endpoints:

#### Health Check
```bash
curl https://back.maxence.design/api/health
```
Expected response:
```json
{"ok": true, "ts": 1234567890}
```

#### API Root
```bash
curl https://back.maxence.design/api
```
Expected response:
```json
{
  "name": "Portfolio API",
  "status": "running", 
  "ts": 1234567890,
  "uptime": 123.45,
  "health": "/api/health",
  "version": "0.0.0",
  "frontend": "https://maxence.design"
}
```

#### Authentication
```bash
curl -X POST https://back.maxence.design/api/auth/signin \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "password"}'
```

#### Blog Posts
```bash
curl https://back.maxence.design/api/blog/posts
```

#### Projects
```bash
curl https://back.maxence.design/api/projects
```

### 3. Frontend Configuration

The frontend is already configured to use the new backend URL via `netlify.toml`:
```toml
VITE_API_BASE_URL = "https://back.maxence.design/api"
```

## Backend Features

### Authentication
- **Username:** `admin`
- **Password:** `password`
- JWT token-based authentication
- 24-hour token expiration

### API Endpoints
- `GET /api/health` - Health check
- `POST /api/auth/signin` - User authentication
- `GET /api/blog/posts` - Get all blog posts
- `GET /api/blog/posts/:slug` - Get post by slug
- `POST /api/blog/posts` - Create new post (auth required)
- `PUT /api/blog/posts/:id` - Update post (auth required)
- `DELETE /api/blog/posts/:id` - Delete post (auth required)
- `GET /api/projects` - Get all projects
- `GET /api/projects/:id` - Get project by ID
- `POST /api/projects` - Create project (auth required)
- `PUT /api/projects/:id` - Update project (auth required)
- `DELETE /api/projects/:id` - Delete project (auth required)
- `POST /api/contact` - Submit contact message
- `GET /api/contact/messages` - Get messages (auth required)
- `PUT /api/contact/messages/:id` - Update message status (auth required)
- `DELETE /api/contact/messages/:id` - Delete message (auth required)
- `GET /api/contact/unread-count` - Get unread count (auth required)

### Database
- SQLite database with auto-initialization
- Sample data included for development
- Persistent storage on Render's filesystem

### CORS Configuration
- Configured for Netlify frontend domain
- Supports credentials and all HTTP methods
- Proper headers for API communication

## Troubleshooting

### Common Issues

1. **Service Not Starting:**
   - Check Render logs for errors
   - Verify Node.js version (should be 20)
   - Ensure `npm install` completed successfully

2. **Database Errors:**
   - Database auto-initializes on first run
   - Check file permissions for `portfolio.db`
   - Verify `DATABASE_PATH` environment variable

3. **CORS Errors:**
   - Verify `FRONTEND_URL` environment variable
   - Check frontend domain in CORS configuration
   - Ensure proper headers are sent

4. **Authentication Issues:**
   - Default admin credentials: admin/password
   - JWT tokens expire after 24 hours
   - Check `JWT_SECRET` environment variable

### Health Check
Always verify the health endpoint is responding:
```bash
curl https://back.maxence.design/api/health
```

## Next Steps

1. Deploy the backend using the steps above
2. Test all endpoints to ensure functionality
3. Verify the frontend connects successfully
4. Update admin credentials for production security

## Support

If you encounter issues:
1. Check Render service logs
2. Verify environment variables
3. Test endpoints individually
4. Check CORS configuration